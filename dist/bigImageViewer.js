/*! ala.module.bigImageViewer - v0.1.0 - 2016-10-21 */
!function(a){"use strict";
//!import 'src/bigImageViewer.tpl'
var b=function(b){b=b||{},this.option={image_list:"",image_wrapper:"",MAX_WIDTH:640,MAX_HEIGHT:480},this.option=a.extend(this.option,b),this.image_list=a(this.option.image_list),this.image_wrapper=this.option.image_wrapper,this.MAX_WIDTH=Math.min(this.option.MAX_WIDTH,$client.screen.dw)-20,this.MAX_HEIGHT=Math.min(this.option.MAX_HEIGHT,$client.screen.dh)-20,this.image_dialog=a(_TPL_).appendTo("body").addClass("hidden"),this.dialog_left_ear=this.image_dialog.find(".prev"),this.dialog_right_ear=this.image_dialog.find(".next"),this.image_dialog.find(".fixed-box").css({"max-width":this.MAX_WIDTH,"max-height":this.MAX_HEIGHT}),this.image_current_wrapper=null,this.image_pre_src=null,this.image_next_src=null,this.init()};b.prototype=a.extend(b.prototype,{init:function(){var b=this;this.image_list.on("click",function(){b.image_current_wrapper=b.image_wrapper?a(this).parents(b.image_wrapper):a(this),b._show(this,this.src,a(this).data("preview"))}),this.image_dialog.on("click",".icon-close",function(){b._hide()}),this.image_dialog.on("click",".image",function(a){a.stopPropagation()}),this.dialog_left_ear.on("click",function(a){a.stopPropagation(),b._switchToPre()}),this.dialog_right_ear.on("click",function(a){a.stopPropagation(),b._switchToNext()}),a(document).on("keydown",function(a){b.image_dialog.hasClass("hidden")||(37===a.keyCode?b.dialog_left_ear.trigger("click"):39===a.keyCode&&b.dialog_right_ear.trigger("click"))})},_show:function(a,b,c){this._width=0,this._height=0;var d=this;if(c){this._width=a.naturalWidth||a.width,this._height=a.naturalHeight||a.height,this.dialog_left_ear.removeClass("hidden"),this.dialog_right_ear.removeClass("hidden"),this.image_dialog.find(".image").addClass("self-loading").css({width:this._width,height:this._height}),0===this.image_dialog.find(".image").children("img").length&&this.image_dialog.find(".image").append('<img src="'+b+'">'),this.image_current_wrapper.prev().length<1&&this.dialog_left_ear.addClass("hidden"),this.image_current_wrapper.next().length<1&&this.dialog_right_ear.addClass("hidden"),this.image_dialog.removeClass("hidden"),ala.page_mask.show();var e=new Image;e.onload=function(){var a=this.width,b=this.height;d._width=a>d.MAX_WIDTH?d.MAX_WIDTH:a,d._height=d._width*b/a,d._height=d._height>d.MAX_HEIGHT?d.MAX_HEIGHT:d._height,d._width=d._height*a/b,d.image_dialog.find(".image").removeClass("self-loading").children("img").attr("src",c),d.image_dialog.find(".image").removeClass("self-loading").animate({width:d._width,height:d._height})},e.src=c}},_hide:function(){ala.page_mask.hide(),this.image_dialog.find(".image").children("img").remove(),this.image_dialog.addClass("hidden")},_switchToPre:function(){this.image_current_wrapper.prev().length<1||(this.image_current_wrapper=this.image_current_wrapper.prev(),this.image_pre_src=this.image_current_wrapper.find("img").data("preview"),this._show(this.image_dialog.find("img"),this.image_dialog.find("img")[0].src,this.image_pre_src))},_switchToNext:function(){this.image_current_wrapper.next().length<1||(this.image_current_wrapper=this.image_current_wrapper.next(),this.image_next_src=this.image_current_wrapper.find("img").data("preview"),this._show(this.image_dialog.find("img"),this.image_dialog.find("img")[0].src,this.image_next_src))}}),window.ala.bigImageViewer=b}(jQuery);